<!html>
<html lang="en">

<head>
	<title>Rainhawk.js Tests</title>
	<script type="text/javascript" src="rainhawk.js"></script>
	<style type="text/css">
		pre {
			line-height: 18px;
			padding: 0;
			margin: 0;
		}
	</style>
</head>

<body>
	<pre>[+] Running tests.</pre>
	<script type="text/javascript">
		/**
		 * Create a debug function.
		 */

		function debug(message) {
			var pre = document.createElement("pre");
			pre.innerHTML = message;
			document.body.appendChild(pre);
		}

		/**
		 * Set the API key.
		 */

		rainhawk.apiKey = "eSQpirMYxjXUs8xIjjaUo72gutwDJ4CP";

		/**
		 * Define the tests to perform in an array with functions and callbacks
		 * so that we can keep references to which test we're on.
		 */

		var tests = [
			/**
			 * Send a ping request to the API and output the user's Mashape
			 * username.
			 */

			function(done) {
				debug("[+] Checking that the API is online...");

				rainhawk.ping(function(data) {
					debug("[+] --> Found username: '" + data.mashape_user + "'.");
					done();
				}, function(message) {
					debug("[!] Could not ping the service - " + message);
					done();
				});
			},

			/**
			 * Output a finished message!
			 */

			function(done) {
				debug("[+] Completed all tests!");
				done();
			}
		];

		/**
		 * Run all of the tests synchronously so that we don't break the order of
		 * operations and invalidate the tests by law.
		 */

		var i = 0;
		var done = false;

		setInterval(function() {
			if(done && tests[i]) {
				done = false;
				tests[i](function() { done = true; i++; });
			}
		}, 10);

		tests[i](function() { done = true; i++; });
	</script>
</body>

</html>